name: "Workflow / Code Scanning - CodeQL"

on:
  workflow_call:
  workflow_dispatch:

jobs:
  CodeQL:

    runs-on: windows-2022

    permissions:
      # required for all workflows
      security-events: write

    steps:
      - name: Folder for Visual Studio 2019 Community
        run: |
          mkdir "C:\Program Files (x86)\Microsoft Visual Studio\2019\"
        shell: cmd

      - name: Link to Visual Studio 2019 Community
        run: |
          mklink /J "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community" "C:\Program Files\Microsoft Visual Studio\2022\Enterprise"
        shell: cmd

      - name: Setup Java JDK
        uses: actions/setup-java@v5
        with:
          java-version: 8
          architecture: x86
          distribution: temurin

      - name: Setup NSIS
        run: |
          choco install --yes nsis --version=3.11 --force

      - name: Git Checkout
        uses: actions/checkout@v5

      - name: Git Submodule Update
        run: |
          git submodule update --init --recursive

      - name: Initialize CodeQL
        uses: github/codeql-action/init@v4
        with:
          languages: csharp

      - name: Build
        run: |
          BuildFullinstaller.cmd
        working-directory: ${{ github.workspace }}\Build
        shell: cmd

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v4
