version: 1.38.Final.{build}
image: Visual Studio 2019
clone_depth: 1
clone_folder: c:\project\mediaportal

max_jobs: 4

environment:
  JAVA_HOME: C:\Program Files (x86)\Java\jdk1.8.0

configuration:
  - x86
  - x64

build:
  parallel: true

matrix:
  fast_finish: true

install:
  - cmd: >-
      git submodule update --init --recursive

      choco install --yes nsis --version=3.11 --force

      java -version

build_script:
  - cmd: >-
      cd c:\project\mediaportal\build\

      BuildFullinstaller.cmd LOG %CONFIGURATION%

      7z a ..\Release\MediaPortalSetup_%CONFIGURATION%_%APPVEYOR_BUILD_VERSION%.%APPVEYOR_REPO_COMMIT%.zip ..\Release\MediaPortalSetup_*.exe

      7z a BuildFullInstaller_%CONFIGURATION%.zip BuildFullInstaller.log

on_failure:
  - ps: Push-AppveyorArtifact BuildFullInstaller.log -FileName BuildError_$Env:CONFIGURATION.log

artifacts:
  - path: Release\MediaPortalSetup_*.zip
    name: Mediaportal Installer
  - path: Build\BuildFullInstaller_*.zip
    name: Mediaportal Build Log

test: off
